%%{init: {'theme': 'dark', 'themeVariables': {'primaryColor': '#151d2e', 'primaryTextColor': '#e2e8f0', 'primaryBorderColor': '#334155', 'lineColor': '#475569', 'secondaryColor': '#1a2438', 'tertiaryColor': '#0a0e17', 'edgeLabelBackground': '#111827', 'clusterBkg': '#111827', 'clusterBorder': '#1e293b'}}}%%

graph TB
    subgraph SITE_A["<b>SITE A ‚Äî Jetson Orin Nano</b>"]
        direction TB
        ARDUINO["üîå Arduino Uno<br/><i>ENS160+AHT21</i><br/><code>temp | humidity | eCO2 | TVOC | AQI</code>"]
        MCP_SERVER["‚öôÔ∏è MCP Arduino Server<br/><i>read_sensor tool</i><br/><code>stdio transport</code>"]
        SENSOR_LOOP["üîÑ Sensor Loop<br/><i>Background asyncio task</i><br/><code>every 10s</code>"]
        JETSON["ü§ñ Jetson ADK Agent<br/><i>LlmAgent + detect_anomalies</i><br/><code>to_a2a() + FastAPI :8080</code>"]
        OLLAMA_J["üß† Ollama ‚Üí LFM2.5-Thinking<br/><i>LiteLLM integration</i>"]
    end

    subgraph CONTROL["<b>CONTROL CENTER ‚Äî Mac</b>"]
        direction TB
        MAC["ü§ñ Mac ADK Agent<br/><i>LlmAgent + RemoteA2aAgent</i><br/><code>to_a2a() + FastAPI :8081</code>"]
        OLLAMA_M["üß† Ollama ‚Üí LFM2.5-Thinking<br/><i>LiteLLM integration</i>"]
        DASHBOARD["üìä Streamlit Dashboard<br/><i>Real-time Visualization</i><br/><code>:8501</code>"]
    end

    ARDUINO -->|"USB Serial<br/>JSON @ 9600 baud"| MCP_SERVER
    MCP_SERVER -->|"MCP Protocol<br/>stdio"| SENSOR_LOOP
    SENSOR_LOOP --> JETSON
    JETSON -->|"LiteLLM ‚Üí Ollama"| OLLAMA_J
    SENSOR_LOOP -->|"REST push<br/>POST /api/sensor/push"| MAC
    JETSON <-->|"<b>A2A Protocol</b><br/>JSON-RPC + /.well-known/agent-card.json"| MAC
    MAC -->|"LiteLLM ‚Üí Ollama"| OLLAMA_M
    MAC -->|"REST /api/*<br/>+ WebSocket /stream"| DASHBOARD
    DASHBOARD -->|"A2A message/send<br/>JSON-RPC"| MAC

    style ARDUINO fill:#1a2438,stroke:#00f0ff,stroke-width:2px,color:#e2e8f0
    style MCP_SERVER fill:#1a2438,stroke:#22c55e,stroke-width:2px,color:#e2e8f0
    style SENSOR_LOOP fill:#1a2438,stroke:#00f0ff,stroke-width:1px,color:#94a3b8
    style JETSON fill:#151d2e,stroke:#00f0ff,stroke-width:2px,color:#e2e8f0
    style MAC fill:#151d2e,stroke:#ffaa00,stroke-width:2px,color:#e2e8f0
    style DASHBOARD fill:#1a2438,stroke:#a78bfa,stroke-width:2px,color:#e2e8f0
    style OLLAMA_J fill:#111827,stroke:#475569,stroke-width:1px,color:#94a3b8
    style OLLAMA_M fill:#111827,stroke:#475569,stroke-width:1px,color:#94a3b8
    style SITE_A fill:#0a0e17,stroke:#00f0ff,stroke-width:1px,color:#00f0ff
    style CONTROL fill:#0a0e17,stroke:#ffaa00,stroke-width:1px,color:#ffaa00
